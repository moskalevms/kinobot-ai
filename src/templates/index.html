<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Kinobot AI ‚Äî –ü–æ–¥–±–æ—Ä —Ñ–∏–ª—å–º–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üé¨ Kinobot AI</h1>
        <p class="subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–æ–¥–±–æ—Ä—É —Ñ–∏–ª—å–º–æ–≤</p>

        <div class="form-group">
            <label for="user-input">–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:</label>
            <input type="text" id="user-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ª—ë–≥–∫—É—é –∫–æ–º–µ–¥–∏—é 2010-—Ö —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –≤—ã—à–µ 7" class="placeholder" style="width: 100%; padding: 12px; font-size: 16px;">
        </div>

        <button id="send-btn">–ù–∞–π—Ç–∏ —Ñ–∏–ª—å–º</button>
        <button id="clear-btn" class="secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading" class="loading hidden">–î—É–º–∞—é... ü§ñ</div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="result" class="result-box hidden">
            <h3 id="result-title">üé¨ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</h3>
            <p><span id="result-description"></span></p>
            <p><strong>‚ÑπÔ∏è –ò—Å—Ç–æ—á–Ω–∏–∫:</strong> <span id="result-source">–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</span></p>
        </div>

        <!-- –û—à–∏–±–∫–∏ -->
        <div id="error" class="result-box hidden" style="border-left-color: #e53e3e; color: #c53030;">
            <h3>–û—à–∏–±–∫–∞</h3>
            <p id="error-text"></p>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å-–±–∞—Ä -->
        <div class="status-bar" id="status-bar">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
    </div>

    <script>
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const clearBtn = document.getElementById('clear-btn');
        const loadingDiv = document.getElementById('loading');
        const resultDiv = document.getElementById('result');
        const errorDiv = document.getElementById('error');
        const statusDiv = document.getElementById('status-bar');

        const resultDescription = document.getElementById('result-description');

        const errorText = document.getElementById('error-text');

        sendBtn.addEventListener('click', async () => {
            const message = userInput.value.trim();
            if (!message) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å");
                return;
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ—à–ª—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');
            statusDiv.textContent = '–î—É–º–∞—é... ü§ñ';

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                loadingDiv.classList.add('hidden');

                if (response.ok) {
                    const data = await response.json();
                    resultDescription.textContent = data.response;
                    resultDiv.classList.remove('hidden');
                    statusDiv.textContent = '–ì–æ—Ç–æ–≤–æ!';
                } else {
                    const errorData = await response.json();
                    errorText.textContent = errorData.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
                    errorDiv.classList.remove('hidden');
                    statusDiv.textContent = '–û—à–∏–±–∫–∞';
                }
            } catch (e) {
                loadingDiv.classList.add('hidden');
                errorText.textContent = `–û—à–∏–±–∫–∞: ${e.message}`;
                errorDiv.classList.remove('hidden');
                statusDiv.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
            }
        });

        // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendBtn.click();
        });

        // –û—á–∏—Å—Ç–∫–∞
        clearBtn.addEventListener('click', () => {
            userInput.value = '';
            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            statusDiv.textContent = '–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞';
        });
    </script>
</body>
</html>